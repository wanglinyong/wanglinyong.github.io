<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/wanglinyong.github.io/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/wanglinyong.github.io/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/wanglinyong.github.io/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/wanglinyong.github.io/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/wanglinyong.github.io/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/wanglinyong.github.io/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/wanglinyong.github.io/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/wanglinyong.github.io/atom.xml" title="Wang's Blog" type="application/atom+xml" />






<meta name="description" content="JAVA，Python，C#，Node.js，个人博客，Github，hexo">
<meta property="og:type" content="website">
<meta property="og:title" content="Wang&#39;s Blog">
<meta property="og:url" content="https://wanglinyong.github.io/index.html">
<meta property="og:site_name" content="Wang&#39;s Blog">
<meta property="og:description" content="JAVA，Python，C#，Node.js，个人博客，Github，hexo">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Wang&#39;s Blog">
<meta name="twitter:description" content="JAVA，Python，C#，Node.js，个人博客，Github，hexo">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/wanglinyong.github.io/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://wanglinyong.github.io/"/>





  <title>Wang's Blog</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?your_id";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>
	<a href="https://github.com/wanglinyong/wanglinyong.github.io/"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/38ef81f8aca64bb9a64448d0d70f1308ef5341ab/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png"></a>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/wanglinyong.github.io/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Wang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/wanglinyong.github.io/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/wanglinyong.github.io/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/wanglinyong.github.io/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/wanglinyong.github.io/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/wanglinyong.github.io/about/index.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/08/31/分布式事务（二）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/08/31/分布式事务（二）/" itemprop="url">分布式事务（二）：基于可靠消息的分布式事务</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-31T20:15:09+08:00">
                2018-08-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/08/31/分布式事务（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/08/31/分布式事务（二）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="项目使用技术"><a href="#项目使用技术" class="headerlink" title="项目使用技术"></a>项目使用技术</h2><p>springboot、dubbo、zookeeper、定时任务</p>
<h2 id="一、项目结构"><a href="#一、项目结构" class="headerlink" title="一、项目结构"></a>一、项目结构</h2><p>maven父子工程：</p>
<p>父工程：consis</p>
<p>子工程：api-service、order、product、message</p>
<p>api-service:该项目主要是提供接口调用的，还包含实体类、枚举等一些通用内容</p>
<p>order:该项目是专门处理订单相关操作的系统</p>
<p>product:该项目是专门处理产品相关操作的系统</p>
<p>message:该项目是提供消息服务的系统，好包括定时任务</p>
<p>它们的依赖关系如下图：</p>
<p><img src="https://images.gitbook.cn/a181d460-acf7-11e8-afe5-6ba901a27e1b" alt="enter image description here"></p>
<p>根据上一篇的原理分别介绍下各个系统的实现</p>
<h2 id="二、order订单系统"><a href="#二、order订单系统" class="headerlink" title="二、order订单系统"></a>二、order订单系统</h2><p><strong>核心代码：</strong></p>
<pre><code>@Override
@Transactional
public void add(Orders order) {
    String messageBody = JSONObject.toJSONString( order );
    //添加消息到数据库
    String messageId = transactionMessageService.savePreparMessage(order.getMessageId(), messageBody, Constant.ORDER_QUEUE_NAME );
    log.info(&quot;&gt;&gt;&gt; 预发送消息,消息编号:{}&quot;, messageId);
    boolean flag = false;
    boolean success = false;
    try{

        Orders orders = orderDao.saveAndFlush( order );
        //int i = 1/0 ;
        log.info(&quot;&gt;&gt;&gt; 插入订单,订单编号:{}&quot;, orders.getId());
        flag = true;
    }catch (Exception e){
        transactionMessageService.delete( messageId );
        log.info(&quot;&gt;&gt;&gt; 业务执行异常删除消息,消息编号:{}&quot;, messageId, e);
        throw new RuntimeException( &quot;&gt;&gt;&gt; 创建订单失败&quot; );
    }finally {
        if(flag){
            try {
                transactionMessageService.confirmAndSend( messageId );
                success = true;
                log.info(&quot;&gt;&gt;&gt; 确认并且发送消息到实时消息中间件,消息编号:{}&quot;, messageId);

            }catch (Exception e){
                log.error(&quot;&gt;&gt;&gt; 消息确认异常,消息编号:{}&quot;, messageId, e);
                if(!success){
                    transactionMessageService.delete( messageId );
                    throw new RuntimeException( &quot;&gt;&gt;&gt; 确认消息异常，创建订单失败&quot; );
                }
            }
        }
    }
}
</code></pre><ul>
<li>插入订单表之前，首先创建预发送消息，保存到事务消息表中，此时消息状态为：未发送</li>
<li>插入订单，如果插入订单失败则将事务消息表中预发送消息删除</li>
<li>插入订单成功后，修改消息表预发送消息状态为发送中，并发送消息至mq</li>
<li>如果发送消息失败，则订单回滚并删除事务消息表消息</li>
</ul>
<h2 id="三、message消息系统"><a href="#三、message消息系统" class="headerlink" title="三、message消息系统"></a>三、message消息系统</h2><p><strong>核心代码一：</strong></p>
<pre><code>@Override
public void sendMessageToMessageQueue(String queueName,final String messageBody) {

    jmsTemplate.convertAndSend( queueName,messageBody );

    log.info(&quot;&gt;&gt;&gt; 发送消息到mq 队列:{},消息内容:{}&quot;, queueName, messageBody);
}
</code></pre><ul>
<li>主要是activemq生产者讲消息发送至MQ消息中间件</li>
</ul>
<p><strong>核心代码二：</strong></p>
<pre><code>/**
 * 定时重发消息（每分钟）
 */
@Scheduled(cron = &quot;0 */1 * * * ?&quot;)
public void    handler(){
    //查询transaction_message表中已发送但未被删除的消息
    List&lt;TransactionMessage&gt; list = transactionMessageService.queryRetryList( Constant.MESSAGE_UNDEAD, maxTimeOut, Constant.MESSAGE_SENDING );
    if(list!=null &amp;&amp; list.size() &gt; 0){
        for (TransactionMessage message:list){
            try {
                transactionMessageService.retry( message.getMessageId() );
            } catch (Exception e) {
                log.warn(&quot;&gt;&gt;&gt; 消息不存在,可能已经被消费,消息编号:{}&quot;, message.getMessageId());
            }
        }
    }
}

/**
 * 定时通知工作人员（每隔5分钟）
 */
@Scheduled(cron = &quot;0 */5 * * * ?&quot;)
public void    advance(){
    List&lt;Long&gt; messages = transactionMessageService.queryDeadList();
    log.warn(&quot;&gt;&gt;&gt; 共有:{}条消息需要人工处理&quot;, messages.size());
    String ids = JSONObject.toJSONString( messages );
    //发邮件或者是发送短信通知工作人员处理

}
</code></pre><ul>
<li>定时重发消息</li>
<li>定时将死亡的消息通知给工作人员，进行人工补偿操作</li>
</ul>
<h2 id="四、product产品系统"><a href="#四、product产品系统" class="headerlink" title="四、product产品系统"></a>四、product产品系统</h2><p><strong>核心代码：</strong></p>
<pre><code>@Transactional
@JmsListener( destination = Constant.ORDER_QUEUE_NAME)
public void    receiveQueue(String msg){
    boolean flag = false;
    Orders orders = JSONObject.parseObject( msg, Orders.class );
    log.info(&quot;&gt;&gt;&gt; 接收到mq消息队列，消息编号:{} ,消息内容:{}&quot;, orders.getMessageId(), msg);

    TransactionMessage transactionMessage = transactionMessageService.findByMessageId( orders.getMessageId() );
    try {
        //保证幂等性
        if(transactionMessage!=null){
            List&lt;OrderDetail&gt; list = orders.getList();
            for(OrderDetail detail : list){
                Product product = productService.findById( detail.getId() );
                Long skuNum = product.getProductSku() - detail.getNum();
                if(skuNum &gt;= 0){
                    product.setProductSku( skuNum );
                    productService.update( product );
                }else {
                    throw new Exception( &quot;&gt;&gt;&gt; 库存不足,修改库存失败！&quot; );
                }

            }
            //int i = 1 /0 ;
            flag = true;
        }

    }catch (Exception e){
        e.printStackTrace();
        throw new RuntimeException( e );
    }finally {
        if(flag){
            transactionMessageService.delete( orders.getMessageId() );
            DbLog dbLog = dbLogService.findByMesageId( orders.getMessageId() );
            if(dbLog!=null){
                dbLog.setState( &quot;1&quot; );//已处理成功
                dbLogService.update( dbLog );
            }
            log.info(&quot;&gt;&gt;&gt; 业务执行成功删除消息! messageId:{}&quot;, orders.getMessageId());
        }
    }

}
</code></pre><ul>
<li>从mq消息中间件中监听并消费消息，将json消息转为订单对象</li>
<li>根据消息编号查询该消息是否已被消费，保证幂等性</li>
<li>如果消息未被消费（即存在此消息），则产品表扣减库存；如果已经消费（不存在此消息），则不做处理</li>
<li>产品表扣减库存成功，则删除此消息，如果待处理消息日志表中有此消息，则更改状态为1，表示已处理；扣减失败，则不做处理</li>
</ul>
<p>该项目源码已上传至github和码云，链接如下，<strong>希望喜欢的朋友都能给个star支持一下！谢谢~</strong></p>
<p>github链接</p>
<pre><code>https://github.com/wanglinyong/consis
</code></pre><p>码云链接</p>
<pre><code>https://gitee.com/wanglinyong/consis
</code></pre>
          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/08/27/分布式事务（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/08/27/分布式事务（一）/" itemprop="url">分布式事务（一）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-27T19:08:22+08:00">
                2018-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/08/27/分布式事务（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/08/27/分布式事务（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、数据库事务"><a href="#一、数据库事务" class="headerlink" title="一、数据库事务"></a>一、数据库事务</h2><p>在介绍分布式事务之前，先简单了解下数据库事务。</p>
<p><strong>数据库事务(Database Transaction) :</strong>是指作为单个逻辑工作单元执行的一系列操作，要么完全地执行，要么完全地不执行。</p>
<p>事务具有ACID四个特性：</p>
<p>1、原子性(Atomic)：事务必须是原子工作单元,对于其修改数据，要么全部成功，要么全部失败。</p>
<p>2、一致性(Consistent):事务在完成时，必须使所有的数据都保持一致状态。</p>
<p>3、隔离性(Insulation):由并发事务所作的修改必须与任何其它并发事务所作的修改隔离。</p>
<p>4、持久性(Duration):事务完成之后，它对于系统的影响是永久性的。</p>
<h2 id="二、分布式事务"><a href="#二、分布式事务" class="headerlink" title="二、分布式事务"></a>二、分布式事务</h2><p>在分布式系统中，不止使用一个数据库，比如订单系统使用db_order数据库，产品系统使用的是db_product数据库，在订单系统中只能保证订单相关操作的事务，在产品系统中只能保证产品相关操作的事务。比如：如果在订单系统中进行生成订单、扣减库存的业务，如果出现异常，那么创建订单的事务会回滚，而扣减库存的事务则不会，因为本地事务是不能夸数据库的。跨库的事务就属于分布式事务。</p>
<p>把分布式系统中两个相关操作看成是一个单元，比如创建订单和修改库存的操作，该单元要么一起成功，要么一起失败，这就是分布式事务。</p>
<p>关于分布式事务你不得不知的两个理论：</p>
<h3 id="1、CAP定理"><a href="#1、CAP定理" class="headerlink" title="1、CAP定理"></a>1、CAP定理</h3><p>CAP原则又称CAP定理，指的是在一个分布式系统中，WEB服务无法同时满足以下3个特性：</p>
<ul>
<li><p>一致性(Consistency) ： 在分布式系统中数据一旦更新，所有数据变动都是同步的</p>
</li>
<li><p>可用性(Availability) ： 好的响应性能，每个操作都必须有预期的响应结束</p>
</li>
<li><p>分区容错性(Partition tolerance) ： 在网络分区的情况下，即使出现单个节点无法可用，系统依然正常对外提供服务</p>
</li>
</ul>
<p>首先在分布式系统中，横向扩展策略依赖于数据分区，所以一般会在一致性和可用性上做出牺牲。</p>
<h3 id="2、BASE理论"><a href="#2、BASE理论" class="headerlink" title="2、BASE理论"></a>2、BASE理论</h3><p>BASE理论中的三个特性：</p>
<ul>
<li><p>Basically Available（基本可用）</p>
</li>
<li><p>Soft state（软状态）</p>
</li>
<li><p>Eventually consistent（最终一致性）</p>
</li>
</ul>
<p>三个特性分别指的是：</p>
<p>（1）基本可用是指分布式系统在出现不可预知的故障的时候，允许损失部分可用性——但请注意，这绝不等价于系统不可用。</p>
<p>（2）软状态，和硬状态对应，是指允许系统中的数据存在中间状态，并认为该中间状态的存在不会影响系统的整体可用性，即允许系统不同节点的数据副本之间进行数据同步的过程存在延时。</p>
<p>（3）最终一致性强调的是系统所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要试试保证系统数据的强一致性。 </p>
<p>BASE理论是对CAP中的一致性和可用性进行一个权衡的结果，理论的核心思想就是：我们无法做到强一致，但每个应用都可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性（Eventual consistency）。</p>
<h2 id="三、分布式事务解决方案"><a href="#三、分布式事务解决方案" class="headerlink" title="三、分布式事务解决方案"></a>三、分布式事务解决方案</h2><p>主要介绍目前主流的两种分布式事务解决方案：</p>
<h3 id="1、TCC-补偿型事务解决方案"><a href="#1、TCC-补偿型事务解决方案" class="headerlink" title="1、TCC-补偿型事务解决方案"></a>1、TCC-补偿型事务解决方案</h3><p>TCC指的是Try(尝试)、Confirm（确认）、Cancle（取消）,其核心思想是：针对每个操作，都要注册一个与其对应的确认和补偿（撤销）操作。它分为三个阶段：</p>
<ul>
<li><p>Try 阶段主要是对业务系统做检测及资源预留</p>
</li>
<li><p>Confirm 阶段主要是对业务系统做确认提交，Try阶段执行成功并开始执行 Confirm阶段时，默认 Confirm阶段是不会出错的。即：只要Try成功，Confirm一定成功。</p>
</li>
<li><p>Cancel 阶段主要是在业务执行错误，需要回滚的状态下执行的业务取消，预留资源释放。</p>
</li>
</ul>
<p>举个例子，假入 Bob 要向 Smith 转账，思路大概是：</p>
<p>1、首先在 Try 阶段，要先调用远程接口把 Smith 和 Bob 的钱给冻结起来。</p>
<p>2、在 Confirm 阶段，执行远程调用的转账的操作，转账成功进行解冻。</p>
<p>3、如果第2步执行成功，那么转账成功，如果第二步执行失败，则调用远程冻结接口对应的解冻方法 (Cancel)。</p>
<p>优点： 跟两阶段提交（2PC）比起来，实现以及流程相对简单了一些，但数据的一致性比2PC也要差一些</p>
<p>缺点： 缺点还是比较明显的，在2,3步中都有可能失败。TCC属于应用层的一种补偿方式，所以需要程序员在实现的时候多写很多补偿的代码，在一些场景中，一些业务流程可能用TCC不太好定义及处理。</p>
<h3 id="2、基于可靠消息的最终一致性解决方案"><a href="#2、基于可靠消息的最终一致性解决方案" class="headerlink" title="2、基于可靠消息的最终一致性解决方案"></a>2、基于可靠消息的最终一致性解决方案</h3><p>举例说明：订单系统创建订单成功后、产品系统扣减相应库存</p>
<p><strong>订单系统流程图如下：</strong></p>
<p><img src="https://images.gitbook.cn/f986cf50-a9d5-11e8-95af-1d569340e767" alt="enter image description here"></p>
<p>1.创建订单之前，创建预发送消息，保存到消息表中，此时消息状态为：未发送</p>
<p>2.创建订单，如果创建订单失败则将消息表预发送消息删除</p>
<p>3.创建订单成功后，修改消息表预发送消息状态为发送中，并发送消息至mq</p>
<p>4.如果发送消息失败，则订单回滚并删除消息表消息；发送成功则万事大吉</p>
<p><strong>产品系统流程图如下：</strong></p>
<p><img src="https://images.gitbook.cn/e1b4c660-a9d1-11e8-93ff-7b60c899eed0" alt="enter image description here"></p>
<p>1.从mq消息中间件中监听并消费消息，将json消息转为订单对象</p>
<p>2.根据消息编号查询该消息是否已被消费，保证幂等性</p>
<p>3.如果消息未被消费（即存在此消息），则产品表扣减库存；如果已经消费（不存在此消息），则不做处理</p>
<p>4.产品表扣减库存成功，则删除此消息；扣减失败，则不做处理</p>
<p>5.定时任务会定时扫描消息表中超时未被消费的消息，然后尝试重发，如果超过最大重试次数后仍未被消费，则记录日志并通知工作人员进行人工补偿操作</p>
<p>基于可靠消息的分布式事务虽然不能保证结果的强一致，但是可以通过可靠消息使得结果最终一致</p>
<p>下一节将给出基于可靠消息的分布式事务demo源码</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/08/21/dubbo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/08/21/dubbo/" itemprop="url">dubbo快速入门</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-21T18:23:48+08:00">
                2018-08-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/08/21/dubbo/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/08/21/dubbo/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、dubbo基本原理"><a href="#一、dubbo基本原理" class="headerlink" title="一、dubbo基本原理"></a>一、dubbo基本原理</h2><p> <strong>dubbo架构图如下：</strong></p>
<p><img src="https://images.gitbook.cn/e0e417a0-a4e9-11e8-a2aa-0bd41466d20f" alt="enter image description here"></p>
<p>节点角色说明</p>
<p><img src="https://images.gitbook.cn/5c2ee5c0-a4ea-11e8-a2aa-0bd41466d20f" alt="enter image description here"></p>
<p>调用关系说明:</p>
<p>0.服务容器负责启动，加载，运行服务提供者。</p>
<p>1.服务提供者在启动时，向注册中心注册自己提供的服务。</p>
<p>2.服务消费者在启动时，向注册中心订阅自己所需的服务。</p>
<p>3.注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。</p>
<p>4.服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。</p>
<p>5.服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。</p>
<p>具体详细内容请参加dubbo官方文档</p>
<pre><code>http://dubbo.apache.org/en-us/
</code></pre><h2 id="二、入门demo简介"><a href="#二、入门demo简介" class="headerlink" title="二、入门demo简介"></a>二、入门demo简介</h2><p>该demo包含三个项目，分别是：</p>
<p>服务提供端项目：provider</p>
<p>服务消费端项目：consumer</p>
<p>共用服务接口项目：api</p>
<p>依赖关系如图：</p>
<p><img src="https://images.gitbook.cn/fa498740-a4ec-11e8-8a5b-85d5618fe6ba" alt="enter image description here"></p>
<p>api项目是一个jar项目，将生成的jar打包到maven仓库，作为provider和consumer项目的依赖导入。</p>
<h2 id="三、dubbo-远程调用（RPC）具体实现"><a href="#三、dubbo-远程调用（RPC）具体实现" class="headerlink" title="三、dubbo-远程调用（RPC）具体实现"></a>三、dubbo-远程调用（RPC）具体实现</h2><h3 id="1、启动zookeeper"><a href="#1、启动zookeeper" class="headerlink" title="1、启动zookeeper"></a>1、启动zookeeper</h3><p>在启动服务提供者项目之前要先启动zookeeper,因为我们需要把服务提供方注册到zookeeper中，然后才能被服务消费方发现并调用。</p>
<p>关于zookeeper这里不做详细介绍了，简单概括就是分布式服务治理框架，用于服务注册与发现，实现远程调用功能等。</p>
<ul>
<li><p>zookeeper下载</p>
<p>  <a href="http://zookeeper.apache.org/" target="_blank" rel="external">http://zookeeper.apache.org/</a></p>
</li>
<li><p>解压并修改配置</p>
</li>
</ul>
<p>zookeeper下载完成后解压到合适目录，然后进入到zookeeper的conf目录，找到zoo_sample.cfg文件将其重命名为zoo.cfg，然后打开该文件，<br>将其中的dataDir和dataLogDir修改如下：</p>
<pre><code>dataDir=E:\\Soft\\zookeeper-3.4.6\\data
dataLogDir=E:\\Soft\\zookeeper-3.4.6\\log
</code></pre><p>修改为你本地硬盘的目录</p>
<ul>
<li>启动zookeeper</li>
</ul>
<p>进入到zookeeper的bin目录下，双击zkServer.cmd,启动zookeeper</p>
<h3 id="2-dubbo接口服务api项目"><a href="#2-dubbo接口服务api项目" class="headerlink" title="2.dubbo接口服务api项目"></a>2.dubbo接口服务api项目</h3><p>新建maven项目api，注意将其pom.xml中的打包方式改为jar</p>
<p>然后在com.dubbo.api.service包下新建DemoService接口，如下：</p>
<pre><code>public interface DemoService {

    String sayHello(String name);
}
</code></pre><p>项目结构如图：</p>
<p><img src="https://images.gitbook.cn/e024d790-a4ef-11e8-a2aa-0bd41466d20f" alt="enter image description here"></p>
<p>然后将项目打包（install一下即可），在E:\temp\api\target\目录下找到该jar，然后打包到本地maven仓库，打开cmd命令窗口，输入以下令如下：</p>
<pre><code>mvn install:install-file -Dfile=E:\temp\api\target\api.jar -DgroupId=com.dubbo.api -DartifactId=api -Dversion=1.0.0 -Dpackaging=jar -DgeneratePom=true -DcreateChecksum=true
</code></pre><p>注意：jar路径该为你自己的路径</p>
<h3 id="3-dubbo服务提供者provider项目"><a href="#3-dubbo服务提供者provider项目" class="headerlink" title="3.dubbo服务提供者provider项目"></a>3.dubbo服务提供者provider项目</h3><p>新建maven项目provider,并在pom.xml中添加以下依赖：</p>
<pre><code> &lt;dependency&gt;
  &lt;groupId&gt;com.dubbo.api&lt;/groupId&gt;
  &lt;artifactId&gt;api&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
  &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
  &lt;version&gt;2.5.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;com.101tec&lt;/groupId&gt;
  &lt;artifactId&gt;zkclient&lt;/artifactId&gt;
  &lt;version&gt;0.10&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
  &lt;version&gt;4.0.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>这里引入了上面的生成的api接口依赖、dubbo依赖、zookeeper客服端依赖以及启动项目必需的依赖</p>
<p>然后在com.dubbo.provider.service.impl包下新建DemoServiceImp并实现DemoService接口，如下：</p>
<pre><code>public class DemoServiceImpl implements DemoService{
@Override
public String sayHello(String name) {
    return &quot;Hello &quot; + name;
}
</code></pre><p>然后在resources下新建provider.xml文件，配置如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;
   xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans
   http://www.springframework.org/schema/beans/spring-beans.xsd
   http://code.alibabatech.com/schema/dubbo
   http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;
&lt;!--定义了提供方应用信息，用于计算依赖关系；在 dubbo-admin 或 dubbo-monitor 会显示这个名字，方便辨识--&gt;
&lt;dubbo:application name=&quot;demo-provider&quot; owner=&quot;wly&quot; organization=&quot;dubbox&quot;/&gt;
&lt;!--使用 zookeeper 注册中心暴露服务，注意要先开启 zookeeper--&gt;
&lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot;/&gt;
&lt;!-- 用dubbo协议在20880端口暴露服务 --&gt;
&lt;dubbo:protocol name=&quot;dubbo&quot; port=&quot;20880&quot; /&gt;
&lt;!--使用 dubbo 协议实现定义好的 api.PermissionService 接口--&gt;
&lt;dubbo:service interface=&quot;com.dubbo.api.service.DemoService&quot; ref=&quot;demoService&quot; protocol=&quot;dubbo&quot; /&gt;
&lt;!--具体实现该接口的 bean--&gt;
&lt;bean id=&quot;demoService&quot; class=&quot;com.dubbo.provider.service.impl.DemoServiceImpl&quot;/&gt;
&lt;/beans&gt;
</code></pre><p>然后在java下直接新建Provider用于启动项目：</p>
<pre><code>public class Provider {
public static void main(String[] args) throws IOException {
    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext(&quot;provider.xml&quot;);
    context.start();
    System.out.println(&quot;dubbo服务提供端已启动....&quot;);
    System.in.read(); // 按任意键退出
}
}
</code></pre><p>provider项目结构如图：</p>
<p><img src="https://images.gitbook.cn/2550e6e0-a4f2-11e8-8b4a-cf3651600922" alt="enter image description here"></p>
<p>然后直接运行该main函数-dubbo服务提供者已启动！</p>
<h3 id="4-dubbo服务消费者consumer项目"><a href="#4-dubbo服务消费者consumer项目" class="headerlink" title="4.dubbo服务消费者consumer项目"></a>4.dubbo服务消费者consumer项目</h3><p>新建maven项目consumer,并在pom.xml中添加以下依赖：</p>
<pre><code> &lt;dependency&gt;
  &lt;groupId&gt;com.dubbo.api&lt;/groupId&gt;
  &lt;artifactId&gt;api&lt;/artifactId&gt;
  &lt;version&gt;1.0.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/com.alibaba/dubbo --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
  &lt;artifactId&gt;dubbo&lt;/artifactId&gt;
  &lt;version&gt;2.5.3&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.101tec&lt;/groupId&gt;
  &lt;artifactId&gt;zkclient&lt;/artifactId&gt;
  &lt;version&gt;0.10&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
  &lt;version&gt;4.0.5.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre><p>和provider项目添加的依赖一样。</p>
<p>然后在resources下新建comsumer.xml，配置服务消费者，如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xmlns:dubbo=&quot;http://code.alibabatech.com/schema/dubbo&quot;
   xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
   http://code.alibabatech.com/schema/dubbo http://code.alibabatech.com/schema/dubbo/dubbo.xsd&quot;&gt;
&lt;dubbo:application name=&quot;demo-consumer&quot; owner=&quot;wly&quot; organization=&quot;dubbox&quot;/&gt;
&lt;!--向 zookeeper 订阅 provider 的地址，由 zookeeper 定时推送--&gt;
&lt;dubbo:registry address=&quot;zookeeper://localhost:2181&quot;/&gt;
&lt;!--使用 dubbo 协议调用定义好的 api.PermissionService 接口--&gt;
&lt;dubbo:reference id=&quot;demoService&quot; interface=&quot;com.dubbo.api.service.DemoService&quot;/&gt;
&lt;/beans&gt;
</code></pre><p>然后在java下新建Consumer.class用于启动该项目，如下：</p>
<pre><code>public class Consumer {
public static void main(String[] args) throws IOException {
    ClassPathXmlApplicationContext context = new ClassPathXmlApplicationContext( &quot;consumer.xml&quot; );
    context.start();
    System.out.println(&quot;dubbo服务消费端已启动...&quot;);
    DemoService demoService = (DemoService)context.getBean( &quot;demoService&quot; );// 获取远程服务代理
    String hello = demoService.sayHello( &quot;world&quot; );//执行远程方法
    System.out.println(hello);//显示调用结果
    System.in.read(); // 按任意键退出
}
}
</code></pre><p>启动该项目，显示调用结果，如图：</p>
<p><img src="https://images.gitbook.cn/dbfc3520-a4f2-11e8-8a5b-85d5618fe6ba" alt="enter image description here"></p>
<p>到这里就已经完成了dubbo的远程调用。下面介绍下dubbo-admin管理管理控制台</p>
<h2 id="四、dubbo-admin管理控制台"><a href="#四、dubbo-admin管理控制台" class="headerlink" title="四、dubbo-admin管理控制台"></a>四、dubbo-admin管理控制台</h2><p>通过dubbo-admin可以更好的管理dubbo服务。</p>
<p>首先下载dubbo-admin的war包，下载地址：</p>
<pre><code>http://www.java1234.com/a/javabook/javaweb/2018/0224/10496.html
</code></pre><p>下载完成后，将dubbo-admin-2.6.0.war复制到tomcat的webapps目录下。然后启动tomcat,访问</p>
<pre><code>http://localhost:8080/dubbo-admin-2.6.0/
</code></pre><p>也可以将dubbo-admin-2.6.0重命名为dubbo-admin访问的时候直接访问<a href="http://localhost:8080/dubbo-admin即可" target="_blank" rel="external">http://localhost:8080/dubbo-admin即可</a></p>
<p>用户名和密码都是root</p>
<p>登录后就可以通过网页进行管理dubbo服务了，如图：</p>
<p><img src="https://images.gitbook.cn/4da3b530-a4f4-11e8-a2aa-0bd41466d20f" alt="enter image description here"></p>
<h2 id="该demo项目以及相关资源下载链接"><a href="#该demo项目以及相关资源下载链接" class="headerlink" title="该demo项目以及相关资源下载链接"></a>该demo项目以及相关资源下载链接</h2><pre><code>https://download.csdn.net/download/abcwanglinyong/10617369
</code></pre>
          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/07/13/solr工作原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/07/13/solr工作原理/" itemprop="url">Solr工作原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-13T14:56:19+08:00">
                2018-07-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Solr/" itemprop="url" rel="index">
                    <span itemprop="name">Solr</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/07/13/solr工作原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/07/13/solr工作原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Solr简介"><a href="#Solr简介" class="headerlink" title="Solr简介"></a>Solr简介</h2><p>Solr是一个独立的企业级搜索应用服务器，它对外提供类似于Web-service的API接口。用户可以通过http请求，向搜索引擎服务器提交一定格式的XML文件，生成索引；也可以通过Http Get操作提出查找请求，并得到XML格式的返回结果。</p>
<p>要想知道solr的实现原理，首先得了解什么是全文检索、solr的索引创建过程和索引搜索过程。</p>
<h2 id="一、全文检索"><a href="#一、全文检索" class="headerlink" title="一、全文检索"></a>一、全文检索</h2><p>首先举个例子：比如现在有5个文档，我现在想从5个文档中查找出包含”solr工作原理”的文档，此时有两种做法：</p>
<p>1.顺序扫描法:对5个文档依次查找，包含目标字段的文档就记录下来，最后查找的结果可能是在2,3文档中，这种查找方式叫做<strong>顺序扫描法</strong>。</p>
<p>顺序扫描法在文档数量较少的情况下，查找速度还是很快的，但是当文档数量很多时，查找速度就差强人意了。</p>
<p>2.全文检索:对文档内容进行分词，对分词后的结果创建索引，然后通过对索引进行搜索的方式叫做<strong>全文检索</strong>。</p>
<p>全文检索就相当于根据偏旁部首或者读音去查找字典，在文档很多的情况，这种查找速度肯定比你一个一个文档查找要快。</p>
<h2 id="二、索引创建和搜索过程"><a href="#二、索引创建和搜索过程" class="headerlink" title="二、索引创建和搜索过程"></a>二、索引创建和搜索过程</h2><h3 id="1-创建索引"><a href="#1-创建索引" class="headerlink" title="1.创建索引"></a>1.创建索引</h3><p>举例子：</p>
<p>文档一：solr是基于Lucene开发的企业级搜索引擎技术</p>
<p>文档二：Solr是一个独立的企业级搜索应用服务器，Solr是一个高性能，基于Lucene的全文搜索服务器</p>
<p>首先经过分词器分词，solr会为分词后的结果（词典）创建索引，然后将索引和文档id列表对应起来，如下图所示：</p>
<p><img src="https://images.gitbook.cn/2b1670f0-8665-11e8-9b0d-95de449dc107" alt="enter image description here"></p>
<p>比如：solr在文档1和文档2中都有出现，所以对应的文档ID列表中既包含文档1的ID也包含文档2的ID，文档ID列表对应到具体的文档，并体现该词典在该文档中出现的频次，频次越多说明权重越大，权重越大搜索的结果就会排在前面。</p>
<p>solr内部会对分词的结果做如下处理：</p>
<p>1.去除停词和标点符号，例如英文的this，that等， 中文的”的”,”一”等没有特殊含义的词</p>
<p>2.会将所有的大写英文字母转换成小写，方便统一创建索引和搜索索引</p>
<p>3.将复数形式转为单数形式，比如students转为student，也是方便统一创建索引和搜索索引</p>
<h3 id="2-索引搜索过程"><a href="#2-索引搜索过程" class="headerlink" title="2.索引搜索过程"></a>2.索引搜索过程</h3><p>知道了创建索引的过程，那么根据索引进行搜索就变得简单了。</p>
<p>1.用户输入搜索条件</p>
<p>2.对搜索条件进行分词处理</p>
<p>3.根据分词的结果查找索引</p>
<p>4.根据索引找到文档ID列表</p>
<p>5.根据文档ID列表找到具体的文档，根据出现的频次等计算权重，最后将文档列表按照权重排序返回</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/07/10/Spring-Security登录认证授权原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/07/10/Spring-Security登录认证授权原理/" itemprop="url">Spring-Security登录认证授权原理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-10T10:09:10+08:00">
                2018-07-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/07/10/Spring-Security登录认证授权原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/07/10/Spring-Security登录认证授权原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>spring-security源码下载地址：</p>
<pre><code>https://github.com/spring-projects/spring-security
</code></pre><h2 id="Spring-Security源码解读："><a href="#Spring-Security源码解读：" class="headerlink" title="Spring-Security源码解读："></a>Spring-Security源码解读：</h2><p>1.使用ctrl+shift+n组合键查找UsernamePasswordAuthenticationFilter过滤器，该过滤器是用来处理用户认证逻辑的，进入后如图：</p>
<p><img src="https://raw.githubusercontent.com/wiki/wanglinyong/wanglinyong.github.io/security-3.png" alt=""></p>
<p>(1)可以看到它默认的登录请求url是”/login”，并且只允许POST方式的请求</p>
<p>(2)obtainUsername()方法点进去发现它默认是根据参数名为”username”和”password”来获取用户名和密码的</p>
<p>(3)通过构造方法实例化一个UsernamePasswordAuthenticationToken对象，此时调用的是UsernamePasswordAuthenticationToken的两个参数的构造函数,如果点击进不去，可直接用ctrl+shift+n查找(等依赖自动下载完成就可以跟进了)，如图：</p>
<p><img src="https://raw.githubusercontent.com/wiki/wanglinyong/wanglinyong.github.io/security-4.png" alt=""></p>
<p>其中super(null)调用的是父类的构造方法，传入的是权限集合，因为目前还没有认证通过，所以不知道有什么权限信息，这里设置为null,然后将用户名和密码分别赋值给principal和credentials，同样因为此时还未进行身份认证，所以setAuthenticated(false)</p>
<p>(4)setDetails(request, authRequest)是将当前的请求信息设置到UsernamePasswordAuthenticationToken中</p>
<p>(5)通过调用getAuthenticationManager()来获取AuthenticationManager，通过调用它的authenticate方法来查找支持该token(UsernamePasswordAuthenticationToken)认证方式的provider，然后调用该provider的authenticate方法进行认证)</p>
<p>2.AuthenticationManager是用来管理AuthenticationProvider的接口，通过查找后进入，然后使用ctrl+H组合键查看它的继承关系，找到ProviderManager实现类，它实现了AuthenticationManager接口，查看它的authenticate方法，它里面有段这样的代码：</p>
<pre><code>for (AuthenticationProvider provider : getProviders()) {
        if (!provider.supports(toTest)) {
            continue;
        }
    ...
    try {
            result = provider.authenticate(authentication);
    ...
    }
}
</code></pre><p>通过for循环遍历AuthenticationProvider对象的集合，找到支持当前认证方式的AuthenticationProvider，找到之后调用该AuthenticationProvider的authenticate方法进行认证处理：</p>
<pre><code>result = provider.authenticate(authentication);
</code></pre><p>3.AuthenticationProvider接口，就是进行身份认证的接口，它里面有两个方法：authenticate认证方法和supports是否支持某种类型token的方法，通过ctrl+h查看继承关系，找到AbstractUserDetailsAuthenticationProvider抽象类，它实现了AuthenticationProvider接口，它的supports方法如下：</p>
<pre><code>public boolean supports(Class&lt;?&gt; authentication) {
    return (UsernamePasswordAuthenticationToken.class
        .isAssignableFrom(authentication));
    }
</code></pre><p>说明它是支持UsernamePasswordAuthenticationToken类型的AuthenticationProvider</p>
<p>再看它的authenticate认证方法，其中有一段这样的代码：</p>
<pre><code>boolean cacheWasUsed = true;
    UserDetails user = this.userCache.getUserFromCache(username);

    if (user == null) {
        cacheWasUsed = false;

        try {
            user = retrieveUser(username,
                    (UsernamePasswordAuthenticationToken) authentication);
        }
    ...
    }
</code></pre><p>如果从缓存中没有获取到UserDetails，那么它调用retrieveUser方法来获取用户信息UserDetails，这里的retrieveUser是抽象方法，等一会我们看它的子类实现。</p>
<p>用户信息UserDetails是个接口，我们进入查看，它包含以下6个接口方法：</p>
<pre><code>Collection&lt;? extends GrantedAuthority&gt; getAuthorities();//获取权限集合
String getPassword();  //获取密码
String getUsername();    //获取用户名
boolean isAccountNonExpired(); //账户未过期
boolean isAccountNonLocked();    //账户未锁定
boolean isCredentialsNonExpired(); //密码未过期
boolean isEnabled();    //账户可用
</code></pre><p>查看它的继承关系发现User类实现了该接口，并实现了该接口的所有方法</p>
<p>接着AbstractUserDetailsAuthenticationProvider往下看，找到下面的代码：</p>
<pre><code>preAuthenticationChecks.check(user);
additionalAuthenticationChecks(user,
            (UsernamePasswordAuthenticationToken) authentication);
</code></pre><p>preAuthenticationChecks预检查，在最下面的内部类DefaultPreAuthenticationChecks中可以看到，它会检查上面提到的三个boolean方法，即检查账户未锁定、账户可用、账户未过期，如果上面的方法只要有一个返回false，就会抛出异常，那么认证就会失败。</p>
<p>additionalAuthenticationChecks是附加检查，是个抽象方法，等下看子类的具体实现。</p>
<p>下面还有个postAuthenticationChecks.check(user)后检查，在最下面的DefaultPostAuthenticationChecks内部类中可以看到，它会检查密码未过期，如果为false就会抛出异常</p>
<p>如果上面的检查都通过并且没有异常，表示认证通过，会调用下面的方法：</p>
<pre><code>createSuccessAuthentication(principalToReturn, authentication, user);
</code></pre><p>跟进发现此时通过构造方法实例化对象UsernamePasswordAuthenticationToken时，调用的是三个参数的构造方法:</p>
<pre><code>    public UsernamePasswordAuthenticationToken(Object principal, Object credentials,
        Collection&lt;? extends GrantedAuthority&gt; authorities) {
    super(authorities);
    this.principal = principal;
    this.credentials = credentials;
    super.setAuthenticated(true); // must use super, as we override
}
</code></pre><p>此时会调用父类的构造方法设置权限信息，并调用父类的setAuthenticated(true)方法，到这里就表示认证通过了。</p>
<p>下面我们看看AbstractUserDetailsAuthenticationProvider的子类，同ctrl+h可查看继承关系，找到DaoAuthenticationProvider</p>
<p>4.DaoAuthenticationProvider类</p>
<p>(1)查看additionalAuthenticationChecks附加检查方法，它主要是检查用户密码的正确性，如果密码为空或者错误都会抛出异常</p>
<p>(2)获取用户信息UserDetails的retrieveUser方法，主要看下面这段代码：</p>
<pre><code>UserDetails loadedUser = this.getUserDetailsService().loadUserByUsername(username);
</code></pre><p>它是调用了getUserDetailsService先获取到UserDetailsService对象，通过调用UserDetailsService对象的loadUserByUsername方法获取用户信息UserDetails</p>
<p>找到UserDetailsService，发现它是一个接口，查看继承关系，有很多实现，都是spring-security提供的实现类，并不满足我们的需要，我们想自己制定获取用户信息的逻辑，所以我们可以实现这个接口。比如从我们的数据库中查找用户信息</p>
<p>5.SecurityContextPersistenceFilter过滤器</p>
<p>那么用户认证成功之后，又是怎么保存认证信息的呢，在下一次请求过来是如何判断该用户是否已经认证了呢？</p>
<p>请求进来时会经过SecurityContextPersistenceFilter过滤器，进入SecurityContextPersistenceFilter过滤器并找到以下代码：</p>
<pre><code>SecurityContext contextBeforeChainExecution = repo.loadContext(holder);
</code></pre><p>从session中获取SecurityContext对象，如果没有就实例化一个SecurityContext对象</p>
<pre><code>SecurityContextHolder.setContext(contextBeforeChainExecution);
</code></pre><p>将SecurityContext对象设置到SecurityContextHolder中</p>
<pre><code>chain.doFilter(holder.getRequest(), holder.getResponse());
</code></pre><p>表示放行，执行下一个过滤器</p>
<p>执行完后面的过滤并经过servlet处理之后，响应给浏览器之前再次经过此过滤器。查看以下代码：</p>
<pre><code>SecurityContext contextAfterChainExecution = SecurityContextHolder.getContext();
SecurityContextHolder.clearContext();
this.repo.saveContext(contextAfterChainExecution, holder.getRequest(), holder.getResponse());
</code></pre><p>通过SecurityContextHolder获取SecurityContext对象，然后清除SecurityContext，最后将获取的SecurityContext对象放入session中</p>
<p>其中SecurityContextHolder是与ThreadLocal绑定的，即本线程内所有的方法都可以获得SecurityContext对象，而SecurityContext对象中包含了Authentication对象，即用户的认证信息，spring-security判断用户是否认证主要是根据SecurityContext中的Authentication对象来判断。Authentication对象的详细信息如图：</p>
<p><img src="https://raw.githubusercontent.com/wiki/wanglinyong/wanglinyong.github.io/security.png" alt=""></p>
<p>最后整个过程的流程大致如下图：</p>
<p><img src="https://raw.githubusercontent.com/wiki/wanglinyong/wanglinyong.github.io/spring-securityx.png" alt=""></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/07/03/获取properties文件内容最简单方式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/07/03/获取properties文件内容最简单方式/" itemprop="url">读取properties文件内容最简单的两种方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-03T08:47:49+08:00">
                2018-07-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/07/03/获取properties文件内容最简单方式/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/07/03/获取properties文件内容最简单方式/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="一、使用ResourceBundle读取jdbc-properties文件"><a href="#一、使用ResourceBundle读取jdbc-properties文件" class="headerlink" title="一、使用ResourceBundle读取jdbc.properties文件"></a>一、使用ResourceBundle读取jdbc.properties文件</h2><pre><code>public static void main(String[] args) {
    ResourceBundle bundle = ResourceBundle.getBundle(&quot;jdbc&quot;);
    String value= bundle.getString(&quot;driverClasss&quot;);
    System.out.println(value);
}
</code></pre><p>结果如下：</p>
<pre><code>com.mysql.jdbc.Driver
</code></pre><h2 id="二、自定义工具类PropertiesUtils读取jdbc-properties文件："><a href="#二、自定义工具类PropertiesUtils读取jdbc-properties文件：" class="headerlink" title="二、自定义工具类PropertiesUtils读取jdbc.properties文件："></a>二、自定义工具类PropertiesUtils读取jdbc.properties文件：</h2><h3 id="1-PropertiesUtils代码如下："><a href="#1-PropertiesUtils代码如下：" class="headerlink" title="1.PropertiesUtils代码如下："></a>1.PropertiesUtils代码如下：</h3><pre><code>import java.io.FileNotFoundException;
import java.io.IOException;
import java.util.Properties;
/**
 * Created by wly on 2018/7/3.
 */
public class  {
private static Properties props = new Properties();

public static String getValue(String key) {
    return props.getProperty(key);
}

public static void updateProperties(String key, String value) {
    props.setProperty(key, value);
}

static {
    try {
        props.load(Thread.currentThread().getContextClassLoader().getResourceAsStream(&quot;jdbc.properties&quot;));
    } catch (FileNotFoundException var1) {
        var1.printStackTrace();
    } catch (IOException var2) {
        var2.printStackTrace();
    }

}
}
</code></pre><h3 id="2-main方法测试"><a href="#2-main方法测试" class="headerlink" title="2.main方法测试"></a>2.main方法测试</h3><pre><code>public static void main(String[] args) {
    String name = getValue( &quot;driverClasss&quot; );
    System.out.println(&quot;mysql的driverClasss===&quot;+name);
    updateProperties( &quot;driverClasss&quot;,&quot;oracle.jdbc.driver.OracleDriver&quot; );
    name = getValue( &quot;driverClasss&quot; );
    System.out.println(&quot;修改成Oracle的driverClasss====&quot;+name);
}
</code></pre><p>测试结果：</p>
<pre><code>mysql的driverClasss===com.mysql.jdbc.Driver

修改成Oracle的driverClasss====oracle.jdbc.driver.OracleDriver
</code></pre><p>一个是根据key获取对应的value值</p>
<p>一个是根据key值设置对应的value值，注意不会改变propertis文件内容</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/07/02/AccessDeniedException如何处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/07/02/AccessDeniedException如何处理/" itemprop="url">AccessDeniedException如何处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-02T10:46:40+08:00">
                2018-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/07/02/AccessDeniedException如何处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/07/02/AccessDeniedException如何处理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有两种情况：</p>
<p>1.用户未登录情况下访问受保护资源</p>
<p>2.用户登录情况下访问被保护资源</p>
<h2 id="一、用户未登录情况下访问受保护资源"><a href="#一、用户未登录情况下访问受保护资源" class="headerlink" title="一、用户未登录情况下访问受保护资源"></a>一、用户未登录情况下访问受保护资源</h2><p>用户在未登录的情况下访问受保护资源时会自动跳转到配置的登录页面。主要是以下这个配置起作用：</p>
<pre><code>&lt;security:http auto-config=&quot;false&quot; access-decision-manager-ref=&quot;accessDecisionManager&quot;
               use-expressions=&quot;true&quot; entry-point-ref=&quot;loginEntryPoint&quot;&gt;

 &lt;bean id=&quot;loginEntryPoint&quot;
    class=&quot;org.springframework.security.web.authentication.LoginUrlAuthenticationEntryPoint&quot;&gt;
    &lt;!-- 默认登录页的url --&gt;
    &lt;constructor-arg value=&quot;/login?error=login&quot;/&gt;
&lt;/bean&gt;

&lt;/security:http&gt;
</code></pre><p>但是这里说的访问路径不包含ajax请求的访问，如果是ajax请求的话，你会看到后台报AccessDeniedException异常，而前台没反应。因为对ajax请求不起作用</p>
<p>此时你可以这样来解决，在发送ajax请求的页面判断用户是否为空，为空则直接跳转到登录页面，如下：</p>
<pre><code> var res = &apos;${user.id}&apos;;
    if(res==&apos;&apos; || res==null){
        window.location.href = &quot;/login.jsp&quot;;
    }
    $.ajax({
    ...
})；
}
</code></pre><p>登录情况下的ajax请求我们下面介绍</p>
<h2 id="二、用户在登录情况下访问受保护资源"><a href="#二、用户在登录情况下访问受保护资源" class="headerlink" title="二、用户在登录情况下访问受保护资源"></a>二、用户在登录情况下访问受保护资源</h2><p>用户在登录情况下访问受保护资源时，可以有两种解决方案：</p>
<h3 id="1-配置403错误页面-有瑕疵"><a href="#1-配置403错误页面-有瑕疵" class="headerlink" title="1.配置403错误页面(有瑕疵)"></a>1.配置403错误页面(有瑕疵)</h3><p>因为我们知道访问受保护资源时会返回403错误码，我们可以直接配置403错误页面</p>
<p>在web.xml中配置错误页面：</p>
<pre><code>&lt;error-page&gt;
    &lt;error-code&gt;403&lt;/error-code&gt;
    &lt;location&gt;/WEB-INF/403.jsp&lt;/location&gt;
&lt;/error-page&gt;
</code></pre><p>在/WEB-INF/下引入403.jsp即可</p>
<p>此时访问受保护资源时会直接跳转到我们配置的403错误页面</p>
<p>但是问题又来了，ajax请求访问受保护资源时同样没有反应，且看下面的解决办法</p>
<h3 id="2-自定义MyAccessDeniedHandler拒绝访问处理器（完美）"><a href="#2-自定义MyAccessDeniedHandler拒绝访问处理器（完美）" class="headerlink" title="2.自定义MyAccessDeniedHandler拒绝访问处理器（完美）"></a>2.自定义MyAccessDeniedHandler拒绝访问处理器（完美）</h3><p>1.新建MyAccessDeniedHandler并实现AccessDeniedHandler接口：</p>
<pre><code>public class MyAccessDeniedHandler implements AccessDeniedHandler{
private String errorPage;
public void handle(HttpServletRequest request, HttpServletResponse response, AccessDeniedException e) throws IOException, ServletException {
    String header = request.getHeader( &quot;X-Requested-With&quot; );
    if (header != null &amp;&amp; &quot;XMLHttpRequest&quot;.equals( header )) {
        //ajax请求
        String jsonObject = &quot;{\&quot;access-denied\&quot;:true}&quot;;
        PrintWriter out = response.getWriter();
        out.print( jsonObject );
        out.flush();
        out.close();
        return;
    } else {
        RequestDispatcher dispatcher = request.getRequestDispatcher( errorPage );
        dispatcher.forward( request, response );
    }
}

public void setErrorPage(String errorPage) {
    if(errorPage != null &amp;&amp; !errorPage.startsWith(&quot;/&quot;)) {
        throw new IllegalArgumentException(&quot;errorPage must begin with &apos;/&apos;&quot;);
    } else {
        this.errorPage = errorPage;
    }
}
}
</code></pre><p>(1)通过setter方法获取配置文件中配置的错误页面</p>
<p>(2)根据请求头信息判断该请求是不是ajax请求</p>
<p>(3)如果是ajax请求，则返回json格式数据{access-denied:true}</p>
<p>(4)如果不是ajax请求则将请求转发到配置的错误页面</p>
<p>2.spring-security.xml配置自定义的AccessDeniedHandler：</p>
<pre><code>&lt;security:access-denied-handler ref=&quot;accessDeniedHandler&quot;/&gt;
&lt;bean id=&quot;accessDeniedHandler&quot; class=&quot;wang.dreamland.www.security.MyAccessDeniedHandler&quot;&gt;
    &lt;property name=&quot;errorPage&quot; value=&quot;/accessDenied.jsp&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
</code></pre><p>3.在webapp目录下新建accessDenied.jsp文件：</p>
<pre><code>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;无访问权限&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;span style=&quot;color: red&quot;&gt;无访问权限&lt;/span&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre><p>4.在发ajax请求的页面做下判断：</p>
<pre><code>$.ajax({
       type:&apos;post&apos;,
       url:&apos;/list&apos;,
       dataType:&apos;json&apos;,
       success:function(data){
           var noAccess = data[&quot;access-denied&quot;]
           if(noAccess){
               window.location.href = &quot;${ctx}/accessDenied.jsp&quot;;
               return
           }
       ...
   }
   });
</code></pre><p>如果noAccess=true则跳转到accessDenied.jsp页面</p>
<p>这样就完美解决了登陆后无访问权限跳转的问题。</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/06/28/Python压缩解压zip文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/06/28/Python压缩解压zip文件/" itemprop="url">Python压缩解压zip文件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-28T11:37:40+08:00">
                2018-06-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/06/28/Python压缩解压zip文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/28/Python压缩解压zip文件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>导入相关模块</p>
<pre><code>import os
import shutil
import zipfile
from os.path import join, getsize
</code></pre><h2 id="一、python压缩指定文件夹"><a href="#一、python压缩指定文件夹" class="headerlink" title="一、python压缩指定文件夹"></a>一、python压缩指定文件夹</h2><pre><code>def zip_file(src_dir):
    zip_name = src_dir +&apos;.zip&apos;
    z = zipfile.ZipFile(zip_name,&apos;w&apos;,zipfile.ZIP_DEFLATED)
    for dirpath, dirnames, filenames in os.walk(src_dir):
        fpath = dirpath.replace(src_dir,&apos;&apos;)
        fpath = fpath and fpath + os.sep or &apos;&apos;
        for filename in filenames:
            z.write(os.path.join(dirpath, filename),fpath+filename)
            print (&apos;==压缩成功==&apos;)
    z.close()
</code></pre><p>其中</p>
<pre><code>src_dir：你要压缩的文件夹的路径

zip_name：压缩后zip文件的路径及名称
</code></pre><h2 id="二、python解压zip"><a href="#二、python解压zip" class="headerlink" title="二、python解压zip"></a>二、python解压zip</h2><pre><code>def unzip_file(zip_src, dst_dir):
    r = zipfile.is_zipfile(zip_src)
    if r:     
        fz = zipfile.ZipFile(zip_src, &apos;r&apos;)
        for file in fz.namelist():
            fz.extract(file, dst_dir)       
    else:
        print(&apos;This is not zip&apos;)
</code></pre><p>其中：</p>
<pre><code>zip_src:是zip文件的全路径

dst_dir：是要解压到的目的文件夹
</code></pre><h2 id="三、Python其它操作文件方法"><a href="#三、Python其它操作文件方法" class="headerlink" title="三、Python其它操作文件方法"></a>三、Python其它操作文件方法</h2><h3 id="1-剪切（移动）文件到指定目录"><a href="#1-剪切（移动）文件到指定目录" class="headerlink" title="1.剪切（移动）文件到指定目录"></a>1.剪切（移动）文件到指定目录</h3><pre><code>shutil.move(filename, dst_dir)
</code></pre><h3 id="2-删除文件夹"><a href="#2-删除文件夹" class="headerlink" title="2.删除文件夹"></a>2.删除文件夹</h3><pre><code>shutil.rmtree(src_dir)
</code></pre><h3 id="3-删除指定文件"><a href="#3-删除指定文件" class="headerlink" title="3.删除指定文件"></a>3.删除指定文件</h3><pre><code>os.remove(file_src)
</code></pre><h3 id="4-新建文件夹"><a href="#4-新建文件夹" class="headerlink" title="4.新建文件夹"></a>4.新建文件夹</h3><pre><code>os.mkdir(dst_dir)
</code></pre><h3 id="5-遍历文件夹"><a href="#5-遍历文件夹" class="headerlink" title="5.遍历文件夹"></a>5.遍历文件夹</h3><pre><code>for filename in os.listdir(src_dir):
</code></pre><h3 id="6-复制文件"><a href="#6-复制文件" class="headerlink" title="6.复制文件"></a>6.复制文件</h3><pre><code>shutil.copyfile(src_file,dst_file)  
</code></pre><h3 id="7-获取文件夹大小"><a href="#7-获取文件夹大小" class="headerlink" title="7.获取文件夹大小"></a>7.获取文件夹大小</h3><pre><code>def get_dir_size(dir_path):
    size = 0L
    for root, dirs, files in os.walk(dir_path):
        size += sum([getsize(join(root, name)) for name in files])
    return size
</code></pre><p>可以根据文件大小做不同的判断，如：</p>
<pre><code>file_size = get_dir_size(DATA_PATH)
max_size = file_size / 1024 / 1024   ##获得的是以Mb为单位的值
if max_size &lt; 100:
    pass
</code></pre>
          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/06/04/dockpanel动态添加picturebox的方法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/06/04/dockpanel动态添加picturebox的方法/" itemprop="url">dockpanel动态添加picturebox并绑定图片</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-04T20:59:40+08:00">
                2018-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/wanglinyong.github.io/categories/C/" itemprop="url" rel="index">
                    <span itemprop="name">C#</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/06/04/dockpanel动态添加picturebox的方法/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/04/dockpanel动态添加picturebox的方法/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于DockManager的使用之前已经介绍过，这里不再赘述。直接说如何在dockpanel中动态添加picturebox并绑定图片。</p>
<h2 id="1-生成picturebox的方法"><a href="#1-生成picturebox的方法" class="headerlink" title="1.生成picturebox的方法"></a>1.生成picturebox的方法</h2><pre><code> public void generatorPictureBox()
{
    int imageNum = 20;//图片的数量
    PictureBox[] pict;
    pict = new PictureBox[imageNum];
    for (int i = 1; i &lt; imageNum; i++)
    {
        pict[i] = new System.Windows.Forms.PictureBox();       
        pict[i].Location = new Point(5 , 10+(i - 1) * 60);//设置图片位置  竖向排列

        pict[i].SizeMode = PictureBoxSizeMode.Zoom;
        pict[i].Image = Image.FromFile(@&quot;D:\images\&quot; + i + &quot;.png&quot;);//导入图片
        pict[i].Size = new Size(50, 50);//设置图片大小
        pict[i].BorderStyle = BorderStyle.None;//取消边框
        pict[i].Image.Tag = i;
        pict[i].Click += singleClick;//给图片绑定点击事件
        dockPanel1.Controls.Add(pict[i]); //添加picturebox

    }

}
</code></pre><h2 id="2-给图片绑定的点击事件"><a href="#2-给图片绑定的点击事件" class="headerlink" title="2.给图片绑定的点击事件"></a>2.给图片绑定的点击事件</h2><pre><code>private void singleClick(object sender, EventArgs e)
  {
      PictureBox p = sender as PictureBox;       
      LOG.Info(&quot;Click===============imgIndex====&quot;+p.Image.Tag);
  }
</code></pre><h2 id="3-在窗体初始化的时候调用generatorPictureBox方法即可"><a href="#3-在窗体初始化的时候调用generatorPictureBox方法即可" class="headerlink" title="3.在窗体初始化的时候调用generatorPictureBox方法即可"></a>3.在窗体初始化的时候调用generatorPictureBox方法即可</h2><h2 id="4-效果如下："><a href="#4-效果如下：" class="headerlink" title="4.效果如下："></a>4.效果如下：</h2><p><img src="https://raw.githubusercontent.com/wiki/wanglinyong/wanglinyong.github.io/doc-1.png" alt=""></p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wanglinyong.github.io/wanglinyong.github.io/2018/05/28/Xshell6下载安装/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="WangLinYong">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/wanglinyong.github.io/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Wang's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/wanglinyong.github.io/2018/05/28/Xshell6下载安装/" itemprop="url">Xshell6下载安装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-28T19:23:20+08:00">
                2018-05-28
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/wanglinyong.github.io/2018/05/28/Xshell6下载安装/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/28/Xshell6下载安装/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>随着xshell5出现评估期已过的问题，发现好多人不知道怎么下载免费版的Xshell，在这里我将详细告诉大家如何下载和安装最新的Xshell6远程管理工具。</p>
<p> 1.进入xshell英文官网，链接地址如下：</p>
<pre><code>http://www.netsarang.com/products/main.html
</code></pre><p>2.将鼠标悬浮在Download上会出现三个列表，点击第三个Free License,如下图：</p>
<p><img src="https://img-blog.csdn.net/20180528160438334" alt=""></p>
<p>或者点击Download，将窗口滚动到最下方，点击Free for Home &amp; School，如下图：</p>
<p><img src="https://img-blog.csdn.net/20180528160452206" alt=""></p>
<p>3.之后会进入Xshell6和Xftp6的下载页面，如下图：</p>
<p><img src="https://img-blog.csdn.net/20180528160508678" alt=""></p>
<p>4.点击Xshell6会跳转到填写个人信息的页面，打红星的是必填项，注意邮箱要正确，会将下载链接发到你的邮箱，如下图：</p>
<p><img src="https://img-blog.csdn.net/20180528160523209" alt=""></p>
<p>5.填写好信息后，点击Submit提交，这时下载链接就会发送到你填写的邮箱了。</p>
<p>6.打开邮箱，点击链接进行下载，如下图：</p>
<p><img src="https://img-blog.csdn.net/20180528160539725" alt=""></p>
<p>7.下载完成后根据提示进行安装即可。</p>
<p>xshell6下载完成以后，一般还需要配合xftp6文件上传工具使用，下载步骤同上。</p>

          
        
      
    </div>
    
    
    
<div>
  
</div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/wanglinyong.github.io/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/wanglinyong.github.io/page/5/">5</a><a class="extend next" rel="next" href="/wanglinyong.github.io/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">WangLinYong</p>
              <p class="site-description motion-element" itemprop="description">JAVA，Python，C#，Node.js，个人博客，Github，hexo</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/wanglinyong.github.io/archives/">
              
                  <span class="site-state-item-count">41</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/wanglinyong.github.io/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/wanglinyong.github.io/tags/index.html">
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/wanglinyong.github.io/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wanglinyong" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/yourname" target="_blank" title="Twitter">
                    
                      <i class="fa fa-fw fa-twitter"></i>Twitter</a>
                </span>
              
            
          </div>

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">WangLinYong</span>

  
</div>


<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/wanglinyong.github.io/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/wanglinyong.github.io/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/wanglinyong.github.io/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/wanglinyong.github.io/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/wanglinyong.github.io/js/src/schemes/pisces.js?v=5.1.3"></script>



  

  


  <script type="text/javascript" src="/wanglinyong.github.io/js/src/bootstrap.js?v=5.1.3"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"your_username"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/wanglinyong.github.io/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/wanglinyong.github.io/js/src/hook-duoshuo.js"></script>
  










  









  





  

  

  
  

  

  

  

</body>
</html>
